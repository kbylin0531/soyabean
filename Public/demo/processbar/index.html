<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>进度条插件progress.js</title>
    <script src="progress.js"></script>
    <style>
        body{
            background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkQAAAG/CAYAAAC5XcgdAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAASAAAAEgARslrPgAAAAl2cEFnAAACRAAAAb8AdBs8GgAABnpJREFUeNrt1iEBAAAIxEBaYb5/LSiB48QVmFp1MgAAn5UIAIAhEgEAMEQiAACGSAgAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIADJEIAIAhEgEAMEQiAACGSAgAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAMAQAQAYIgAAQwQAYIgAAAwRAIAhAgAwRAAAhggAwBABABgiAABDBABgiAAADBEAgCECADBEAACGCADAEAEAGCIAAEMEAGCIAAAMEQCAIQIAMEQAAIYIAODEAp8Vd3TOVdrpAAAAAElFTkSuQmCC");
        }
        .pro {
            width: 200px;
            margin: 100px auto;
        }
    </style>
    <script>

        var progress = (function () {
            var env = this;
            var convention = {
                width : 200,
                height: 30,
                bgColor : "#005538",
                proColor : "#009988",
                fontColor : "#FFFFFF",
                val : 10,
                text:"#*val*#%",
                showPresent : true,
                completeCallback:function(){},
                changeCallback:function(){}
            };
            //origin option
            return {
                val:0,
                options:{},
                strTemp:'',
                proBox:null,
                proBg:null,
                proPre:null,
                proFont:null,
                showPresent:true,
                init:function (ops) {
                    var env = this;
                    //初始化
                    utils.each(ops,function (item,key) {
                        if(convention.hasOwnProperty(key)){
                            env.options[key] = ops.hasOwnProperty(key)?ops[key]:convention[key];
                        }
                    });

                    env.strTemp = env.options.text.substring(0,env.options.text.indexOf('#*'))+"{{pro}}"+env.options.text.substring(env.options.text.indexOf('*#')+2);
                    //do init
                    env.proBox = document.createElement('div');
                    env.proBg = document.createElement('div');
                    env.proPre = document.createElement('div');
                    env.proFont = document.createElement('div');

                    utils.addClass(env.proBox,'proBox');
                    utils.addClass(env.proBg,'proBg');
                    utils.addClass(env.proPre,'proPre');
                    utils.addClass(env.proFont,'proFont');

                    env.proBox.setAttribute("style","width:"+env.options.width+"px; height:"+env.options.height+"px; position:relative; overflow:hidden; box-shadow:0 0 5px #FFFFFF; -moz-box-shadow:0 0 5px #FFFFFF; -webkit-box-shadow:0 0 5px #FFFFFF; -o-box-shadow:0 0 5px #FFFFFF;");
                    env.proBg.setAttribute("style","background-color:"+env.options.bgColor+"; position:absolute; z-index:1; width:100%; height:100%; top:0; left:0;");
                    env.proPre.setAttribute("style","transition:all 300ms; -moz-transition:all 300ms; -webkit-transition:all 300ms; -o-transition:all 300ms; width:"+env.options.val+"%; height:100%; background-color:"+env.options.proColor+"; position:absolute; z-index:2; top:0; left:0;");

                    if(env.showPresent){
                        env.proFont.setAttribute("style","overflow:hidden;text-overflow:ellipsis; white-space:nowrap; *white-space:nowrap; width:100%; height:100%; color:"+this.fontColor+"; text-align:center; line-height:"+this.h+"px; z-index:3; position:absolute; font-size:12px;");
                        var text = env.parseText();
                        env.proFont.innerHTML = text;
                        env.proFont.setAttribute("title",text);
                        env.proBox.appendChild(env.proFont);
                    }


                    env.proBox.appendChild(env.proBg);
                    env.proBox.appendChild(env.proPre);
                    return env;
                },
                refresh : function(){
                    this.proPre.style.width = this.val+"%";
                    this.proFont.innerHTML = this.parseText();
                },
                parseText : function(){
                    this.text = this.strTemp.replace("{{pro}}",this.options.val);
                    return this.text;
                },
                update : function(val){
                    this.val = val;
                    this.refresh();
                    this.changeCallback.call(this,val);
                    if(val==100){
                        this.completeCallback.call(this,val);
                    }
                },
                getBody : function(){
                    return this.proBox;
                },
                getVal : function(){
                    return this.val;
                }
            };
        })();

        window.onload = function(){
            soya.utils.init({
                width : 200,//进度条宽度
                height: 30,//进度条高度
                bgColor : "#3E4E5E",//背景颜色
                proColor : "#009988",//前景颜色
                fontColor : "#FFFFFF",//显示字体颜色
                val : 10,//默认值
                text:"当前进度为#*val*#%",//显示文字信息
                showPresent : true,
                completeCallback:function(){
                    console.log('已完成');
                },
                changeCallback:function(val){
                    console.log(val+'%');
                }
            });

            document.getElementsByClassName('pro')[0].appendChild(Progress.getBody());

            setTimeout(function(){
                Progress.update(50);
                setTimeout(function(){

                    Progress.update(10);
                    setTimeout(function(){

                        Progress.update(100);
                        setTimeout(function(){

                            Progress.update(0);
                        },3000);
                    },3000);

                },3000);
            },3000);
        };

    </script>
</head>
<body>
    <div class="pro"></div>
</body>
</html>